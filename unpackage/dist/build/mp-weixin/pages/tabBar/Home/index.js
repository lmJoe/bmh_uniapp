"use strict";var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,r=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,o=require("../../../common/vendor.js"),h=require("../../../stores/counter.js"),l=require("../../../utils/request.js"),d=require("../../../utils/untis.js");require("../../../utils/ajax.js"),require("../../../utils/api.js");const c=h.userStore(),g={components:{mediaItem:()=>"./news-item.js"},data:()=>({newsList:[],cacheTab:[],tabIndex:0,tabBars:[],scrollInto:"",showTips:!1,navigateFlag:!1,pulling:!1,pageIndex:1,pageSize:10,channelId:""}),onLoad(){setTimeout((()=>{this.tabBars.forEach((e=>{this.newsList.push({data:[],isLoading:!1,refreshText:"",loadingText:"加载更多..."})})),this.getList(0)}),1e3)},mounted(){this.getChannelList()},onPullDownRefresh(){console.log("onPullDownRefresh"),o.index.stopPullDownRefresh()},methods:{getChannelList(){l.getChannelList((e=>{if(1==e.code){let o=e.data;o=o.map(((e,o)=>{return h=((e,t)=>{for(var a in t||(t={}))i.call(t,a)&&r(e,a,t[a]);if(s)for(var a of s(t))n.call(t,a)&&r(e,a,t[a]);return e})({},e),t(h,a({id:"ID"+o}));var h})),this.tabBars=o,this.channelId=e.data[0].Channel_Id,c.setNavId(e.data[0].Channel_Id),console.log("response",this.tabBars),console.log("navId",c.navId)}}))},getList(e){console.log(e),l.getVideoList(this.pageIndex,this.pageSize,this.channelId,(t=>{if(console.log(t),1==t.code){let a=t.data;for(let e in a)a[e].Duration=d.changeHourMinutestr(a[e].Duration),a[e].CoverImgs=a[e].CoverImgs.replace("baomihua","pomoho"),a[e].HeadImg=a[e].HeadImg.replace("baomihua","pomoho");let s=this.newsList[e];s.data=s.data.concat(a),console.log("this.newsList",this.newsList)}}))},goDetail(e){this.navigateFlag||(this.navigateFlag=!0,o.index.navigateTo({url:"./detail/detail?id="+e.Video_ID}),setTimeout((()=>{this.navigateFlag=!1}),200))},close(e,t){o.index.showModal({content:"是否删除本条信息？",success:a=>{a.confirm&&this.newsList[e].data.splice(t,1)}})},loadMore(e){setTimeout((()=>{this.pageIndex=this.pageIndex+1,this.getList(this.tabIndex)}),500)},ontabtap(e){let t=e.target.dataset.current||e.currentTarget.dataset.current;this.switchTab(t)},ontabchange(e){let t=e.target.current||e.detail.current;this.switchTab(t)},switchTab(e){if(0===this.newsList[e].data.length)for(let t in this.tabBars)Number(t)==e&&(this.channelId=this.tabBars[t].Channel_Id,this.getList(e));if(this.tabIndex!==e){if(this.newsList[this.tabIndex].data.length>100){this.cacheTab.indexOf(this.tabIndex)<0&&this.cacheTab.push(this.tabIndex)}if(this.tabIndex=e,this.scrollInto=this.tabBars[e].id,console.log("this.scrollInto",this.scrollInto),this.cacheTab.length>3){let e=this.cacheTab[0];this.clearTabData(e),this.cacheTab.splice(0,1)}}},clearTabData(e){this.newsList[e].data.length=0,this.newsList[e].loadingText="加载更多..."},refreshData(){},onrefresh(e){var t=this.newsList[this.tabIndex];t.refreshFlag&&(t.refreshing=!0,t.refreshText="正在刷新...",setTimeout((()=>{this.refreshData(),this.pulling=!0,t.refreshing=!1,t.refreshFlag=!1,t.refreshText="已刷新",setTimeout((()=>{this.pulling=!1}),500)}),2e3))},onpullingdown(e){var t=this.newsList[this.tabIndex];t.refreshing||this.pulling||(Math.abs(e.pullingDistance)>Math.abs(e.viewHeight)?(t.refreshFlag=!0,t.refreshText="释放立即刷新"):(t.refreshFlag=!1,t.refreshText="下拉可以刷新"))},newGuid(){let e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return(e()+e()+"-"+e()+"-4"+e().substr(0,3)+"-"+e()+"-"+e()+e()+e()).toUpperCase()}}};if(!Array){o.resolveComponent("media-item")()}var b=o._export_sfc(g,[["render",function(e,t,a,s,i,n){return{a:o.f(i.tabBars,((e,t,a)=>({a:o.t(e.ChannelName),b:o.n(i.tabIndex==t?"uni-tab-item-title-active":""),c:e.Channel_Id,d:e.id,e:t,f:o.o(((...e)=>n.ontabtap&&n.ontabtap(...e)),e.Channel_Id)}))),b:i.scrollInto,c:o.f(i.newsList,((e,t,a)=>o.e({a:o.f(e.data,((e,t,s)=>({a:o.o((t=>n.goDetail(e))),b:"6b389f7c-0-"+a+"-"+s,c:o.p({options:e}),d:e.id}))),b:e.isLoading||e.data.length>4},e.isLoading||e.data.length>4?{c:o.t(e.loadingText)}:{},{d:o.o((e=>n.loadMore(t))),e:t}))),d:i.tabIndex,e:o.o(((...e)=>n.ontabchange&&n.ontabchange(...e)))}}],["__scopeId","data-v-6b389f7c"]]);wx.createPage(b);
